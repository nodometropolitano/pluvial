<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>Tipologías de Precariedad - Nodo Metropolitano</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css' rel='stylesheet' />
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" rel="stylesheet">
  <style>
    /*CSS*/
    body {
      margin: 0;
      padding: 0;
      font-family: Roboto, Arial, sans-serif;
      font-size: 14px;
    }

    #header {
      position: relative;
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      margin: 20px;
      color: rgba(0, 0, 0, 0.8);
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      margin-top: 60px;
      width: 100%;
    }

    li {
      padding: 3px 0;
    }

    #panel {
      background: white;
      width: 300px;
      height: auto;
      border: 1px solid rgba(0, 0, 0, 0.05);
      position: absolute;
      right: 20px;
      bottom: 40px;
      box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.2);
      color: #404040;
      border-radius: 4px;
      letter-spacing: .01em;
    }

    h4 {
      text-transform: uppercase;
      border-bottom: 1px solid #ddd;
      margin: 0;
      padding: 14px;
      color: #404040;
      letter-spacing: .05em;
      font-size: 14px;
      font-weight: 700;
    }

    ul {
      list-style-type: none;
      margin: 0;
      padding: 16px;
    }

    ul span {
      width: 10px;
      height: 10px;
      display: inline-block;
      margin-right: 8px;
      border-radius: 50%;
    }

    li {
      padding: 3px 0;
    }

    dd {
      margin-left: 0px;
      margin-left: 0px;
      margin-bottom: 0px;
      margin-top: 0px;
      font-weight: bold;
      color: rgba(0, 0, 0, .6);
    }

    .mapboxgl-popup-content {
      font-size: 14px;
      min-width: 200px;
      max-width: 400px;
      box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.2);
    }

    dl {
      margin-bottom: 0px;
      margin-top: 0px;
      color: rgba(0, 0, 0, 0.4);
    }
  </style>
</head>


<body>

  <div id='header'>Tipologías de Precariedad Hídrica (PH) y Social (PS)</div>

  <div id='map'></div>

  <div id="panel">
    <h4>Tipologías</h4>
    <ul>
      <li><span style="background: hsla(120, 80%, 40%, 0.6);"></span>PH Baja / PS Baja</li>
      <li><span style="background: hsla(270, 100%, 50%, 0.4);"></span>PH Baja / PS Media baja</li>
      <li><span style="background: hsla(270, 100%, 50%, 0.6);"></span>PH Baja / PS Media</li>
      <li><span style="background: hsla(270, 100%, 50%, 0.8);"></span>PH Baja / PS Media alta</li>
      <li><span style="background: hsl(270, 100%, 50%);"></span>PH Baja / PS Alta</li>
      <li><span style="background: hsla(30, 100%, 50%, 0.5);"></span>PH Media / PS Baja</li>
      <li><span style="background: hsla(30, 100%, 50%, 0.75);"></span>PH Media / PS Media</li>
      <li><span style="background: hsl(30, 100%, 50%);"></span>PH Media / PS Alta</li>
      <li><span style="background: hsl(0, 80%, 50%);"></span>PH Alta / PS Alta</li>
    </ul>
  </div>


  <script type="text/javascript">
    var tiposPrecariedad = {
      'PH Baja / PS Baja': 'PH Baja / PS Baja',
      'PH Baja / PS Media baja': 'PH Baja / PS Media baja',
      'PH Baja / PS Media': 'PH Baja / PS Media',
      'PH Baja / PS Media alta': 'PH Baja / PS Media alta',
      'PH Baja / PS Alta': 'PH Baja / PS Alta',
      'PH Media / PS Baja': 'PH Media / PS Baja',
      'PH Media / PS Media': 'PH Media / PS Media',
      'PH Media / PS Alta': 'PH Media / PS Alta',
      'PH Alta / PS Alta': 'PH Alta / PS Alta',
    };
    var colorPrecariedad = {
      'PH Baja / PS Baja': ' style="color:hsla(120, 80%, 40%, 0.6);"',
      'PH Baja / PS Media baja': ' style="color:hsla(270, 100%, 50%, 0.4);"',
      'PH Baja / PS Media': ' style="color:hsla(270, 100%, 50%, 0.6);"',
      'PH Baja / PS Media alta': ' style="color:hsla(270, 100%, 50%, 0.8);"',
      'PH Baja / PS Alta': ' style="color:hsl(270, 100%, 50%);"',
      'PH Media / PS Baja': ' style="color:hsla(30, 100%, 50%, 0.5);"',
      'PH Media / PS Media': ' style="color:hsla(30, 100%, 50%, 0.75);"',
      'PH Media / PS Alta': ' style="color:hsl(30, 100%, 50%);"',
      'PH Alta / PS Alta': ' style="color:hsl(0, 80%, 50%);"',
    };

    // Map
    mapboxgl.accessToken =
      'pk.eyJ1Ijoibm9kb21ldHJvcG9saXRhbm8iLCJhIjoiY2pkZjlqNnFhMDUxNDJ4cGdqZWp2YjF0cSJ9.4Ya-PINBWt2DjO1-XboVCw'
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/nodometropolitano/cjhghdn154qa82spnhq3x8mvd',
      center: [-99.15, 19.35],
      zoom: 12,
      minZoom: 12,
      maxZoom: 15.5,
      maxBounds: [
        [-99.45, 19.0],
        [-98.85, 19.65]
      ],
      hash: false,
      logoPosition: 'bottom-left',
      attributionControl: false
    });

    // Controls
    map.addControl(new mapboxgl.NavigationControl(), 'top-right')

    var geoControl = new mapboxgl.GeolocateControl({
      positionOptions: {
        enableHighAccuracy: true
      },
      trackUserLocation: true
    })

    map.addControl(geoControl, 'top-right')


    // Change the cursor to a pointer when the mouse is over the places layer.
    map.on('mouseenter', 'tipos-precariedad', function () {
      map.getCanvas().style.cursor = 'pointer';
    });

    // Change it back to a pointer when it leaves.
    map.on('mouseleave', 'tipos-precariedad', function () {
      map.getCanvas().style.cursor = '';
    });


    // Mouse click
    map.on('click', function (event) {
      var geometry = event.point;
      var parameters = {
        layers: ['tipos-precariedad']
      };

      var features = map.queryRenderedFeatures(geometry, parameters);
      var geo = features[0];

      if (features.length) {
        var coordinates = event.lngLat; // or var coordinates = geo.geometry.coordinates.slice();

        // Data points //.manz ph cl
        var cluster = tiposPrecariedad[geo.properties['manz ph cl']] || '—';
        var color = colorPrecariedad[geo.properties['manz ph cl']] || '';
        //var ind_fisico = geo.properties.IND_FISICO || '—';
        //var ind_social = geo.properties.IND_SOCIAL || '—';

        var popup = new mapboxgl.Popup()
          .setLngLat(coordinates)
          .setHTML('<dl>' +
            '<dt>Tipología de precariedad:</dt>' +
            '<dd' + color + '>' + cluster + '</dd>' +
            //'<dt>Indicador Hídrico</dt>' +
            //'<dd>' + ind_fisico + '</dd>' +
            //'<dt>Indicador Social</dt>' +
            //'<dd>' + ind_social + '</dd>' +
            '</dl>')
          .addTo(map);
      }
    });
  </script>

</body>

</html>