<!DOCTYPE html>

<html lang="es" dir="ltr">

  <head>

    <meta charset='utf-8'>
    <meta name='viewport' content='initial-scale=1, width=device-width'>

    <title>Tipologías de Precariedad</title>

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.css' rel='stylesheet'>

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,700' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400' rel='stylesheet'>

    <style>
      /*CSS*/

      body {
        margin: 0;
        padding: 0;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
      }

      .content {
        position: absolute;
        height: 100%;
        width: 100%;
        display: flex;
      }

      #pane {
        width: 33%;
        margin: 2%;
      }

      h1 {
        font-size: 32px;
        font-weight: 700;
        text-align: left;
        letter-spacing: .02em;
        color: #202020;
        margin: 0;
      }

      #b_title {
        color: #00ccff;
      }

      p {
        margin-top: 30px;
        font-family: 'Roboto Slab', serif;
        text-align: left;
        font-weight: 400;
        color: #808080;
      }

      b {
        font-family: 'Roboto', sans-serif;
        font-weight: 700;
        letter-spacing: .02em;
        color: #404040;
      }

      #footer {
        position: absolute;
        font-size: 10px;
        font-weight: 500;
        color: #808080;
        bottom: 10px;
        left: 10px;
      }

      #map {
        flex-grow: 1;
      }

      a {
        color: #606060;
      }

      dd {
        margin-left: 0px;
        margin-left: 0px;
        margin-bottom: 0px;
        margin-top: 0px;
        font-weight: bold;
        color: rgba(0, 0, 0, .6);
      }

      .mapboxgl-popup-content {
        font-size: 14px;
        min-width: 200px;
        max-width: 400px;
        box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.2);
      }

      dl {
        margin-bottom: 0px;
        margin-top: 0px;
        color: rgba(0, 0, 0, 0.4);
      }
    </style>
  </head>


  <body>
    <style>
      body * {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      .map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 63%;
      }

      .mapboxgl-compare {
        background-color: #fff;
        position: absolute;
        width: 2px;
        height: 100%;
        z-index: 1;
      }

      .mapboxgl-compare .compare-swiper {
        background-color: #00ccff;
        box-shadow: inset 0 0 0 2px #ffffff;
        display: inline-block;
        border-radius: 50%;
        position: absolute;
        width: 44px;
        height: 44px;
        top: 50%;
        left: -22px;
        margin: -22px 1px 0;
        color: #ffffff;
        cursor: ew-resize;
        background-repeat: no-repeat;
        background-size: 100%;
        background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiICAgd2lkdGg9IjYwIiAgIGhlaWdodD0iNjAiICAgdmVyc2lvbj0iMS4xIiAgIHZpZXdCb3g9IjAgMCA2MCA2MCIgICBpZD0ic3ZnNTQzNCIgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkxK2RldmVsK29zeG1lbnUgcjEyOTExIiAgIHNvZGlwb2RpOmRvY25hbWU9Imwtci5zdmciPiAgPG1ldGFkYXRhICAgICBpZD0ibWV0YWRhdGE1NDQ0Ij4gICAgPHJkZjpSREY+ICAgICAgPGNjOldvcmsgICAgICAgICByZGY6YWJvdXQ9IiI+ICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gICAgICAgIDxkYzp0eXBlICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+ICAgICAgPC9jYzpXb3JrPiAgICA8L3JkZjpSREY+ICA8L21ldGFkYXRhPiAgPGRlZnMgICAgIGlkPSJkZWZzNTQ0MiIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIgICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IiAgICAgYm9yZGVyb3BhY2l0eT0iMSIgICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiICAgICBncmlkdG9sZXJhbmNlPSIxMCIgICAgIGd1aWRldG9sZXJhbmNlPSIxMCIgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTI4NiIgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijc1MSIgICAgIGlkPSJuYW1lZHZpZXc1NDQwIiAgICAgc2hvd2dyaWQ9InRydWUiICAgICBpbmtzY2FwZTp6b29tPSI0IiAgICAgaW5rc2NhcGU6Y3g9IjI1Ljg4OTgzMSIgICAgIGlua3NjYXBlOmN5PSIzNC4zODE4MzMiICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIgICAgIGlua3NjYXBlOndpbmRvdy15PSIyMyIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc1NDM0IiAgICAgaW5rc2NhcGU6b2JqZWN0LW5vZGVzPSJ0cnVlIiAgICAgaW5rc2NhcGU6c25hcC1zbW9vdGgtbm9kZXM9InRydWUiPiAgICA8aW5rc2NhcGU6Z3JpZCAgICAgICB0eXBlPSJ4eWdyaWQiICAgICAgIGlkPSJncmlkNTk4OSIgLz4gIDwvc29kaXBvZGk6bmFtZWR2aWV3PiAgPHBhdGggICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAgICAgZD0iTSAyNSAyNCBMIDE2IDMwIEwgMjUgMzYgTCAyNSAyNCB6IE0gMzUgMjQgTCAzNSAzNiBMIDQ0IDMwIEwgMzUgMjQgeiAiICAgICBpZD0icGF0aDU5OTUiIC8+PC9zdmc+);
      }
    </style>

    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-compare/v0.1.0/mapbox-gl-compare.js'></script>

    <div class='content'>
      <div id='pane'>
        <h1 id='title'>Captación de <b id=b_title>Agua Pluvial</b><br/>en la Ciudad de México</h1>
        <p>
          Texto y gráfica interactiva... Tipologías de Precariedad. Existen dos componentes <b>Precariedad Hídrica</b> (PH), la cual trata acerca del acceso <mark>al agua</mark>, y la Precariedad Social (PS), la cual trata acerca de la marginación y desarrollo.
        </p>
        <div id='footer'>
          Desarrollado por: <a href='http://www.nodometropolitano.com/' target='_blank' title='Nodo Metropolitano'>Nodo Metropolitano S.C.</a>
        </div>
      </div>
      <div id='map'>
        <div id='left' class='map'></div>
        <div id='right' class='map'></div>
      </div>
    </div>


    <script>
      // Dict
      var tiposPrecariedad = {
        'PH Baja / PS Baja': 'PH Baja / PS Baja',
        'PH Baja / PS Media baja': 'PH Baja / PS Media baja',
        'PH Baja / PS Media': 'PH Baja / PS Media',
        'PH Baja / PS Media alta': 'PH Baja / PS Media alta',
        'PH Baja / PS Alta': 'PH Baja / PS Alta',
        'PH Media / PS Baja': 'PH Media / PS Baja',
        'PH Media / PS Media': 'PH Media / PS Media',
        'PH Media / PS Alta': 'PH Media / PS Alta',
        'PH Alta / PS Alta': 'PH Alta / PS Alta',
      };
      var colorPrecariedad = {
        'PH Baja / PS Baja': ' style="color:hsla(120, 80%, 40%, 0.6);"',
        'PH Baja / PS Media baja': ' style="color:hsla(270, 100%, 50%, 0.4);"',
        'PH Baja / PS Media': ' style="color:hsla(270, 100%, 50%, 0.6);"',
        'PH Baja / PS Media alta': ' style="color:hsla(270, 100%, 50%, 0.8);"',
        'PH Baja / PS Alta': ' style="color:hsl(270, 100%, 50%);"',
        'PH Media / PS Baja': ' style="color:hsla(30, 100%, 50%, 0.5);"',
        'PH Media / PS Media': ' style="color:hsla(30, 100%, 50%, 0.75);"',
        'PH Media / PS Alta': ' style="color:hsl(30, 100%, 50%);"',
        'PH Alta / PS Alta': ' style="color:hsl(0, 80%, 50%);"',
      };

      // Map variables
      var center = [-99.15, 19.35]; // starting position
      var zoom = 11.75; // starting zoom
      var minZoom = 11;
      var maxZoom = 15.5;
      var maxBounds = [
        [-99.45, 19.0],
        [-98.85, 19.65]
      ];


      // Map
      mapboxgl.accessToken = 'pk.eyJ1Ijoibm9kb21ldHJvcG9saXRhbm8iLCJhIjoiY2pkZjlqNnFhMDUxNDJ4cGdqZWp2YjF0cSJ9.4Ya-PINBWt2DjO1-XboVCw';
      var map_tipologias = new mapboxgl.Map({
        container: 'left', // container id
        style: 'mapbox://styles/nodometropolitano/cjhghdn154qa82spnhq3x8mvd',
        center: center,
        zoom: zoom,
        minZoom: minZoom,
        maxZoom: maxZoom,
        maxBounds: maxBounds,
        hash: false,
        logoPosition: 'bottom-left'
      });

      var map_modelo = new mapboxgl.Map({
        container: 'right', // container id
        style: 'mapbox://styles/nodometropolitano/cjhghdn154qa82spnhq3x8mvd',
        center: center,
        zoom: zoom,
        minZoom: minZoom,
        maxZoom: maxZoom,
        maxBounds: maxBounds,
        hash: false,
        logoPosition: 'bottom-left'
      });

      var map = new mapboxgl.Compare(map_tipologias, map_modelo, {});
      map._setPosition(map._bounds.width * .8);

      // Source: Tipologías
      map_tipologias.on('load', function() {
        map_tipologias.addSource('tipologias', {
          'type': 'geojson',
          'data': 'https://raw.githubusercontent.com/nodometropolitano/pluvial/master/data/tipologias.geojson'
        });
        map_tipologias.addLayer({
          'id': 'CLUSTER',
          'type': 'fill',
          'source': 'tipologias',
          'layout': {},
          'paint': {
            'fill-color': [
              'match', [
                'string', ['get', 'CLUSTER']
              ],

              //'PH Baja / PS Baja': '#7ee07e',
              //'PH Baja / PS Media baja': '#cc99ff',
              //'PH Baja / PS Media': '#b366ff',
              //'PH Baja / PS Media alta': '#9933ff',
              //'PH Baja / PS Alta': '#8000ff',
              //'PH Media / PS Baja': '#ffbf7f',
              //'PH Media / PS Media': '#ffa040',
              //'PH Media / PS Alta': '#ff8000',
              //'PH Alta / PS Alta': '#ff0000',

              'PH Baja / PS Baja',
              '#7ee07e',//'hsla(120, 80%, 40%, 0.4)',
              'PH Baja / PS Media baja',
              'hsla(270, 100%, 50%, 0.4)',
              'PH Baja / PS Media',
              'hsla(270, 100%, 50%, 0.6)',
              'PH Baja / PS Media alta',
              'hsla(270, 100%, 50%, 0.8)',
              'PH Baja / PS Alta',
              'hsl(270, 100%, 50%)',
              'PH Media / PS Baja',
              'hsla(30, 100%, 50%, 0.5)',
              'PH Media / PS Media',
              'hsla(30, 100%, 50%, 0.75)',
              'PH Media / PS Alta',
              'hsl(30, 100%, 50%)',
              'PH Alta / PS Alta',
              'hsl(0, 80%, 50%)',
              'hsla(0, 0%, 100%, 0)'
            ],
            'fill-opacity': .75,
            'fill-antialias': true,
            'fill-outline-color': [
    "interpolate",
    ["exponential", 1],
    ["zoom"],
    12,
    "hsla(0, 0%, 100%, 0.5)",
    16,
    "hsl(0, 100%, 100%)"
  ]
          }
        }, 'road');
      });


      // Navigation
      map_tipologias.addControl(new mapboxgl.NavigationControl(), 'top-right');

      // Change the cursor to a pointer when the mouse is over the places layer.
      map_tipologias.on('mouseenter', 'CLUSTER', function() {
        map_tipologias.getCanvas().style.cursor = 'pointer';
      });

      // Change it back to a pointer when it leaves.
      map_tipologias.on('mouseleave', 'CLUSTER', function() {
        map_tipologias.getCanvas().style.cursor = '';
      });

      var popup;
      var popup2;
      // Mouse click
      map_tipologias.on('click', function(event) {
        var geometry = event.point;
        var parameters = {
          layers: ['CLUSTER']
        };

        var features = map_tipologias.queryRenderedFeatures(geometry, parameters);
        var geo = features[0];

        if (features.length) {
          var coordinates = event.lngLat; // or var coordinates = geo.geometry.coordinates.slice();

          // Data points //.manz ph cl
          // var cluster = tiposPrecariedad[geo.properties['CLUSTER']] || '—'; // verbose
          var cluster = geo.properties['CLUSTER'] || '—';
          var color = colorPrecariedad[geo.properties['CLUSTER']] || '';
          //var ind_fisico = geo.properties.IND_FISICO || '—';
          //var ind_social = geo.properties.IND_SOCIAL || '—';

          popup = new mapboxgl.Popup()
            .setLngLat(coordinates)
            .setHTML('<dl>' +
              '<dt>Tipología:</dt>' +
              '<dd' + color + '>' + cluster + '</dd>' +
              //'<dt>Indicador Hídrico</dt>' +
              //'<dd>' + ind_fisico + '</dd>' +
              //'<dt>Indicador Social</dt>' +
              //'<dd>' + ind_social + '</dd>' +
              '</dl>')
            .addTo(map_tipologias);

            popup2 = new mapboxgl.Popup()
              .setLngLat(coordinates)
              .setHTML('<dl>' +
                '<dt>Tipología:</dt>' +
                '<dd' + color + '>' + cluster + '</dd>' +
                //'<dt>Indicador Hídrico</dt>' +
                //'<dd>' + ind_fisico + '</dd>' +
                //'<dt>Indicador Social</dt>' +
                //'<dd>' + ind_social + '</dd>' +
                '</dl>')
              .addTo(map_modelo);
        }
      });




    </script>

  </body>

</html>
